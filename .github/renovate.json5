{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended",
    "github>truecharts/public//.github/renovate/main.json5"
  ],
  "minor": {
    "packageRules": [
      {
        "matchPackageNames": ["ghcr.io/siderolabs/kubelet", "ghcr.io/siderolabs/installer"],
        "dependencyDashboardApproval": true
      }
    ]
  },
  "packageRules": [
    {
      // Keep Hoarder main image on 'release' tag
      "matchDatasources": ["docker"],
      "matchPackageNames": ["ghcr.io/hoarder-app/hoarder"],
      "allowedVersions": "release",
      "description": "Always use the 'release' tag for Hoarder main image"
    }
  ],
  // Add custom managers to sync with official Hoarder repository
  "customManagers": [
    {
      // Extract Meilisearch version from Hoarder's Kubernetes manifests
      "customType": "regex",
      "fileMatch": ["^clusters/main/kubernetes/apps/hoarder/app/helm-release\\.yaml$"],
      "matchStrings": [
        "meilisearchImage:\\s+repository:\\s+(?<depName>.*?)\\s+pullPolicy:\\s+.*?\\s+tag:\\s+\"(?<currentValue>.*?)\""
      ],
      "datasourceTemplate": "github-contents",
      "registryUrlTemplate": "https://api.github.com/repos/hoarder-app/hoarder/contents/kubernetes/meilisearch-deployment.yaml",
      "extractVersionTemplate": "image: getmeili\\/meilisearch:(?<version>.*?)\\n"
    },
    {
      // Extract Chrome version from Hoarder's Kubernetes manifests
      "customType": "regex",
      "fileMatch": ["^clusters/main/kubernetes/apps/hoarder/app/helm-release\\.yaml$"],
      "matchStrings": [
        "chromeImage:\\s+repository:\\s+(?<depName>.*?)\\s+pullPolicy:\\s+.*?\\s+tag:\\s+\"(?<currentValue>.*?)\""
      ],
      "datasourceTemplate": "github-contents",
      "registryUrlTemplate": "https://api.github.com/repos/hoarder-app/hoarder/contents/kubernetes/chrome-deployment.yaml",
      "extractVersionTemplate": "image: gcr.io\\/zenika-hub\\/alpine-chrome:(?<version>.*?)\\n"
    }
  ],
  "hostRules": [
    {
      "matchHost": "https://api.github.com/repos/hoarder-app/hoarder/contents",
      "hostType": "github-contents"
    }
  ]
}
