apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
    name: jelly-plex
    namespace: jelly-plex
spec:
    interval: 15m
    chart:
        spec:
            chart: custom-app
            version: 14.2.0
            sourceRef:
                kind: HelmRepository
                name: truecharts
                namespace: flux-system
    releaseName: jelly-plex
    values:
        TZ: US/Central
        release_name: jelly-plex
        service:
            main:
                ports:
                    main:
                        port: 10400
        workload:
            main:
                podSpec:
                    securityContext:
                        runAsUser: 0
                        allowPrivilegeEscalation: true
                    containers:
                        main:
                            securityContext:
                                privileged: true
                            env:
                                DRYRUN: "False"
                                JELLYFIN_BASEURL: http://jellyfin.jellyfin.svc.cluster.local:8096
                                JELLYFIN_TOKEN: ${JELLYFIN_TOKEN}
                                PLEX_BASEURL: http://plex.plex.svc.cluster.local:32400
                                PLEX_TOKEN: ${PLEX_TOKEN}
                                SSL_BYPASS: "True"
                                SYNC_FROM_PLEX_TO_JELLYFIN: "True"
                                USER_MAPPING: '{"lucky": "luckycold"}'
                            probes:
                                liveness:
                                    enabled: false
                                readiness:
                                    enabled: false
                                startup:
                                    enabled: false
                replicas: 1
                type: Deployment
