apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
    name: rsshub
    namespace: rsshub
spec:
    interval: 15m
    chart:
        spec:
            chart: rsshub
            version: 13.1.39
            sourceRef:
                kind: HelmRepository
                name: truecharts
                namespace: flux-system
    releaseName: rsshub
    values:
        TZ: US/Central
        additionalContainers:
            browserless:
                image: '{{ .Values.browserlessImage.repository }}:{{ .Values.browserlessImage.tag }}'
                name: browserless
                ports:
                    - containerPort: 3000
                      name: main
        addons:
            codeserver:
                enabled: false
            netshoot:
                enabled: false
            vpn:
                type: disabled
        browserlessImage:
            repository: browserless/chrome
            tag: 1.61.1-chrome-stable@sha256:efac47cfff3830d9a50b27d29f8bbb61949058ae336c823fbe9bd3c0d1debcc8
        ingress:
            main:
                enabled: true
                hosts:
                    - host: hub.${DOMAIN_0}
                      paths:
                        - path: /
                          pathType: Prefix
                ingressClassName: ""
                integrations:
                    certManager:
                        certificateIssuer: domain-0-le-prod
                        enabled: true
                    homepage:
                        enabled: false
                    traefik:
                        allowCors: false
                        enabled: true
                        entrypoints:
                            - websecure
        redis:
            enabled: true
            includeCommon: true
            redisUsername: default
        release_name: rsshub
        resources: {}
        securityContext:
            container:
                UMASK: "0022"
                readOnlyRootFilesystem: false
                runAsGroup: 0
                runAsNonRoot: false
                runAsUser: 0
            pod:
                fsGroupChangePolicy: OnRootMismatch
        service:
            main:
                enabled: true
                ports:
                    main:
                        port: 10191
                type: ClusterIP
        updated: true
        workload:
            main:
                podSpec:
                    containers:
                        main:
                            env:
                                ACCESS_KEY:
                                    name: ACCESS_KEY
                                    value: ${RSSHUB_ACCESS_KEY}
                                BITBUCKET_PASSWORD: ""
                                BITBUCKET_USERNAME: ""
                                CACHE_TYPE: redis
                                DISALLOW_ROBOT: true
                                GITHUB_ACCESS_TOKEN: ""
                                GOOGLE_FONTS_API_KEY: ""
                                HTTP_BASIC_AUTH_NAME: ""
                                HTTP_BASIC_AUTH_PASS: ""
                                LASTFM_API_KEY: ""
                                NODE_ENV: production
                                NODE_NAME: '{{ .Release.Name }}-{{ randAlphaNum 5 }}'
                                PORT: '{{ .Values.service.main.ports.main.port }}'
                                PUPPETEER_WS_ENDPOINT: ws://localhost:3000
                                REDIS_URL:
                                    secretKeyRef:
                                        expandObjectName: false
                                        key: url
                                        name: '{{ printf "%s-%s" .Release.Name "rediscreds" }}'
                                TELEGRAM_TOKEN: ""
                                TITLE_LENGTH_LIMIT: 150
                                TWITTER_COOKIE:
                                    name: TWITTER_COOKIE
                                    value: ${RSSHUB_TWITTER_COOKIE}
                                YOUTUBE_KEY: ""
                replicas: 1
                type: Deployment
